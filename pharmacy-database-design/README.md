
# Введение
Важной чертой эффективной работы является быстрый доступ к необходимым ресурсам. Если работа требует информационного оснащения, то необходимо предусмотреть легкий, быстрый поиск информации, а также систематизацию новой информации.
Первичным и важнейшим этапом многих бизнес-процессов, происходящих в любой организации, является систематизация информации. Благодаря тщательно проведённой систематизации информации удаётся достичь высоких результатов в процессе оптимизации делопроизводства, а также в экономии средств компании и рабочего времени сотрудников. 
Проектирование баз данных — одна из наиболее сложных и ответственных задач, связанных с созданием информационной системы.
База данных – поименованная совокупность структурированных данных, относящихся к определённой предметной области. 
Перед созданием БД необходимо располагать описанием выбранной предметной области, которое должно охватывать реальные объекты и процессы, определить все необходимые источники информации для удовлетворения предполагаемых запросов пользователей и определить потребности в обработке данных. На основе такого описания на этапе проектирования БД определяются состав и структура данных предметной области, которые должны находиться в БД и обеспечивать выполнение необходимых запросов и задач пользователей. Структура данных предметной области может отображаться информационно-логической моделью. На основе этой модели легко создается реляционная БД. 
Реляционная БД – это совокупность связанных между собой двумерных таблиц, в которых хранится информация об объектах. Запись (строка) включает в себя данные об одном объекте, а в полях (столбцах) содержатся различные его характеристики.

MySQL — свободная реляционная система управления базами данных (СУБД). Под системой управления понимается комплекс программ, который позволяет не только хранить большие массивы данных в определенном формате, но и обрабатывать их, представляя в удобном для пользователей виде. MySQL дает возможность также автоматизировать часто выполняемые операции (например, расчет заработной платы, учет материальных ценностей и т.п.). 

Основная цель проектирования баз данных состоит в получении такого проекта, который удовлетворяет следующим требованиям:
1) Корректность схемы БД, то есть база должна быть гомоморфным образом моделируемой предметной области, где каждому объекту предметной области соответствует данные в памяти ЭВМ, а каждому процессу – адекватные процедуры обработки данных.
2) Обеспечение ограничений
3) Эффективность функционирования
4) Защита данных
5) Простота и удобство эксплуатации
6) Гибкость, т.е. возможность развития БД.

**Целью** написания курсового проекта является знакомство с особенностями осуществления деятельности в рамках выбранного направления подготовки и получение навыков применения теоретических знаний и практических умений, полученных во время изучения предмета, в практической деятельности.

**Задача** курсового проекта: закрепление полученных знаний и приобретение первоначальных практических навыков при выполнении лабораторных и осуществлении самостоятельной деятельности, навыков и способностей аналитической работы и построения на ее основе концепции ИТ-проекта.

**Актуальность** проекта: для каждой аптеки нужна база данных для работы с данными о лекарствах, клиентах, заказах и т. д. 
Данная работа содержит анализ предметной области, разработку реляционной базы данных (концептуальное, логическое и физическое), создание БД средствами СУБД, ввод начальных данных и получение конечных данных с помощью SQL запросов.

# 1 Анализ предметной области

В данной курсовой работе будет реализована база данных аптеки.
Исполнителями будут являться сотрудники аптеки. Сотрудник вносит в базу данных информацию о лекарствах, заказах, поставках и клиентах. Также, в зависимости от изменений в поставляемых лекарственных средствах, сотрудник может вносить изменения в данные: редактировать стоимость, форму выпуска. Пользователем данного механизма является сотрудник, не включенный в базу данных.
Пользователь может произвести покупку лекарственных средств. Сам пользователь не работает с базой данных. Все данные о взаимодействиях с аптекой пользователя вносятся администратором – сотрудником аптеки, не включенным в базу данных.

Определение правил:
- Клиент может заказать несколько лекарственных препаратов.
- Поставщик может осуществить поставку нескольких лекарственных препаратов.
- Заказом занимается один сотрудник.
- Клиент может быть как юридическим, так и частным лицом.
- Закупочная стоимость лекарственных препаратов и цена продажи различны.
- Функции, которые будет выполнять база данных:
- Хранение данных о каждом лекарстве на складе, клиентах, поставщиках, сотрудниках аптеки.
- Возможность клиентам осуществлять покупку лекарственных препаратов.
- Возможность найти клиентов по заказам.
- Возможность определить поставщиков.
- Возможность найти дату оплаты услуги от клиента.
- Добавление новых лекарств по мере их поступления на склад аптеки.

База данных содержит ряд сущностей, определенных в соответствии с предметной областью:
- Лекарство. Данная таблица содержит в себе информацию о названии лекарственного препарата, стране производителя, форме выпуска, сроке годности, действующем веществе, дозировке, стоимости за ед., а также коде назначения.
- Назначение. Данная таблица содержит в себе информацию о группе назначения лекарственного средства.
- Клиент. Данная таблица содержит в себе информацию о клиенте: ФИО или название фирмы, адрес, телефон.
- Сотрудник. Данная таблица содержит в себе информацию об сотруднике: ФИО, дату найма, образование и телефон.
- Поставщик. Данная таблица содержит в себе информацию о поставщике: название фирмы, адрес, телефон, ИНН.
- Поставка. Данная таблица содержит информацию о том, кто является поставщиком и дата поставки.
- Заказ. Данная таблица содержит информацию о заказе: определяет клиента, сотрудника и дату заказа.
- Товарная накладная заказа. Данная таблица содержит информацию о продажах в заказах.
- Товарная накладная поставки. Данная таблица содержит информацию о закупках в поставках.
- Продажа. Данная таблица содержит информацию о продаже: лекарство, количество, стоимость.
- Закупка. Данная таблица содержит информацию о закупке: лекарство, количество, стоимость.
- Должность. Данная таблица содержит информацию о должности: ее наименование и оклад.
# 2 Постановка задач

Разработать структуру базовых таблиц базы данных аптеки для обработки поставок, покупок и хранения лекарственных средств, удовлетворяющих требованиям целостности, непротиворечивости и не избыточности.
Создать структуры базовых таблиц, установить межтабличные связи между ними (схема данных) и наполнить их содержимым.

Группы пользователей:
- Администраторы – работники, которые взаимодействуют с базой данных, могут редактировать данные о лекарствах, заказах и поставках.
- Клиенты – не взаимодействуют с базой данных, информация об их оплате вносится в базу администратором, клиенты могут только осуществить заказ.

Вводные данные:
- Информация о аптеке
- Информация о поставщике
- Информация о клиенте
- Информация о заказе
- Информация о поставке
- Информация о лекарственном препарате

Вывести следующие данные (SQL запросы):
- Название лекарственного препарата, его поставщик (запрос с INNER JOIN, ORDER BY).
- Лекарства, заказанные до определенного числа (запрос с GROUP BY, LEFT OUTER JOIN).
- Данные о поставках за все время (запрос с ORDER BY).
- Количество лекарств, стоимость которых ниже 500 у.е. (запрос с функцией COUNT (агрегирования)).
- Название лекарства, его стоимость, страна производителя и название фирмы поставщика (запрос с INNER JOIN).
- Названия лекарственных препаратов и группы их назначения.
- Товарные накладные заказов, номера которых совпадают с номерами заказов (запрос с рекурсивной функцией).
- Количество товарных накладных по каждому клиенту (таблицы, связанные более чем по одному полю).



# 3 Проектирование реляционной базы данных

## 3.1 Концептуальное проектирование
### Таблица 1
Сущности и их атрибуты

| Сущность  | Атрибуты                                                                                                                                                      |
| --------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Лекарство | Название, Страна производителя, Форма выпуска, В упаковке, Срок годности, Действующее вещество, Дозировка, Стоимость, Группа назначения, Описание назначения. |
| Клиент    | Название фирмы, Адрес, Телефон                                                                                                                                |
| Сотрудник | Имя, Фамилия, Отчество, Код должности, Дата найма, Телефон, Должность, Оклад, Образование                                                                     |
| Заказ     | Сотрудник, Клиент, Дата размещения                                                                                                                            |
| Поставка  | Поставщик, Дата поставки                                                                                                                                      |
| Продажа   | Лекарство, Количество, Стоимость                                                                                                                              |
| Закупка   | Лекарство, Количество, Стоимость                                                                                                                              |
| Поставщик | Название фирмы, Адрес, Телефон, ИНН                                                                                                                           |

## 3.2 Логическое проектирование БД
Цель логического проектирования – развить концептуальную схему БД с учетом принимаемой модели БД.
Создаю логическую структуру реляционной базы данных:

### Таблица 2
Связи между сущностями

| Сущности | Связь |
| --- | --- |
| Лекарство-Продажа | Одному лекарству могут соответствовать несколько продаж. Связь: 1:М. |
| Лекарство-Закупка | Одному лекарству могут соответствовать несколько закупок. Связь: 1:М. |
| Назначение лекарства-Лекарство | Одному назначению могут соответствовать несколько лекарств. Связь: 1:М. |
| Клиент-Заказ | Одному клиенту может соответствовать несколько заказов. Связь: 1:М. |
| Сотрудник-Заказ | Одному сотруднику может соответствовать несколько заказов. Связь: 1:М. |
| Заказ-Товарная накладная заказа | Одному заказу может соответствовать несколько товарных накладных. Связь: 1:М. |
| Поставка-Товарная накладная поставки | Одной поставке может соответствовать несколько закупок. Связь: 1:М. |
| Товарная накладная заказа-Продажа | Одной товарной накладной заказа может соответствовать несколько продаж. Связь: 1:М. |
| Товарная накладная поставки-Закупка | Одной товарной накладной поставки может соответствовать несколько закупок. Связь: 1:М. |
| Поставщик-Поставка | Одному поставщику может соответствовать несколько поставок. Связь: 1:М. |

Процесс нормализации проходил следующим образом:
**1NF:**
Каждое поле в каждой таблице подразумевает только одно атомарное значение
Порядок записей не имеет значения (от перестановки записей местами в таблице их смысл и содержание не изменится)

При заполнении таблицы «Лекарство» в полях «Название», «Форма выпуска», может возникнут атомарная ошибка, вызванная вводом в эти поля нескольких значений, которые могут быть объединены общим полем «Код лекарства». Поэтому каждое значение поля должно содержать одно атомарное значение.

**2NF:**
БД в первой нормальной форме
Все таблицы имеют первичный ключ (добавил первичный ключ к каждой таблице)
Все не ключевые атрибуты зависят от первичного ключа

При объединении таблиц «Товарная накладная заказа» и «Заказ» возникала бы неполная зависимость от первичного ключа. Поэтому было принято решение о разделении одной таблицы на две.
При объединении таблиц «Товарная накладная поставки» и «Поставка» возникала бы неполная зависимость от первичного ключа. Поэтому было принято решение о разделении одной таблицы на две.

**3NF:**
Ни один не ключевой атрибут не зависит от другого не ключевого атрибута (убрал транзитивные зависимости)

При объединении таблиц «Сотрудник» и «Должность» возникала бы транзитивная зависимость поля «Оклад» от поля «Должность», а оно, в свою очередь, зависело бы от первичного ключа, но поле «Оклад» не зависело от первичного ключа. Поэтому было принято решение о разделении одной таблицы на две.
При объединении таблиц «Лекарство» и «Назначение лекарства» возникала бы транзитивная зависимость поля «Описание» от поля «Группа назначения», а оно, в свою очередь, зависело бы от первичного ключа, но поле «Описание» не зависело от первичного ключа. Поэтому было принято решение о разделении одной таблицы на две.

## 3.3 Физическое проектирование

### Таблица 3
Лекарство

| Наименование поля | Тип поля | Ключевое поле | Вид |
| --- | --- | --- | --- |
| Код лекарства | Числовой(11) | Первичный ключ | Обязательное |
| Название | Текстовый(50) |  | Обязательное |
| Страна производителя | Текстовый(50) |  | Обязательное |
| Форма выпуска | Текстовый(30) |  | Обязательное |
| В упаковке | Текстовый(10) |  | Обязательное |
| Срок годности | Дата |  | Обязательное |
| Действующее вещество | Текстовый(50) |  | Обязательное |
| Дозировка | Текстовый(100) |  | Обязательное |
| Стоимость | Плавающая точка |  | Обязательное |
| Код назначения | Числовой(11) |  | Обязательное |

### Таблица 4
Назначение лекарства

| Наименование поля | Тип поля | Ключевое поле | Вид |
| --- | --- | --- | --- |
| Код назначения | Числовой(11) | Первичный ключ | Обязательное |
| Группа | Текстовый(50) |  | Обязательное |
| Описание | Текстовый(200) |  | Обязательное |

### Таблица 5
Товарная накладная заказа

| Наименование поля | Тип поля | Ключевое поле | Вид |
| --- | --- | --- | --- |
| Код товарной накладной | Числовой(11) | Первичный ключ | Обязательное |
| Код заказа | Числовой(11) |  | Обязательное |

### Таблица 6
Товарная накладная поставки

| Наименование поля | Тип поля | Ключевое поле | Вид |
| --- | --- | --- | --- |
| Код товарной накладной | Числовой(11) | Первичный ключ | Обязательное |
| Код поставки | Числовой(11) |  | Обязательное |

### Таблица 7
Продажа

| Наименование поля | Тип поля | Ключевое поле | Вид |
| --- | --- | --- | --- |
| Код продажи | Числовой(11) | Первичный ключ | Обязательное |
| Код товарной накладной | Числовой(11) |  | Обязательное |
| Код лекарства | Числовой(11) |  | Обязательное |
| Количество | Числовой(11) |  | Обязательное |
| Стоимость | Плавающая точка |  | Обязательное |

### Таблица 8
Закупка

| Наименование поля | Тип поля | Ключевое поле | Вид |
| --- | --- | --- | --- |
| Код закупки | Числовой(11) | Первичный ключ | Обязательное |
| Код товарной накладной | Числовой(11) |  | Обязательное |
| Код лекарства | Числовой(11) |  | Обязательное |
| Количество | Числовой(11) |  | Обязательное |
| Стоимость | Плавающая точка |  | Обязательное |

### Таблица 9
Заказ

| Наименование поля | Тип поля | Ключевое поле | Вид |
| --- | --- | --- | --- |
| Код заказа | Числовой(11) | Первичный ключ | Обязательное |
| Код сотрудника | Числовой(11) |  | Обязательное |
| Код клиента | Числовой(11) |  | Обязательное |
| Дата размещения | Дата |  | Обязательное |

### Таблица 10
Поставка

| Наименование поля | Тип поля | Ключевое поле | Вид |
| --- | --- | --- | --- |
| Код поставки | Числовой(11) | Первичный ключ | Обязательное |
| Код поставщика | Числовой(11) |  | Обязательное |
| Дата поставки | Дата |  | Обязательное |

### Таблица 11
Сотрудник

| Наименование поля | Тип поля | Ключевое поле | Вид |
| --- | --- | --- | --- |
| Код сотрудника | Числовой(11) | Первичный ключ | Обязательное |
| Фамилия | Текстовый(50) |  | Обязательное |
| Имя | Текстовый(50) |  | Обязательное |
| Отчество | Текстовый(50) |  | Обязательное |
| Код должности | Числовой(11) |  | Обязательное |
| Дата найма | Дата |  | Обязательное |
| Телефон | Текстовый(11) |  | Обязательное |
| Образование | Текстовый(200) |  | Обязательное |

### Таблица 12
Должность

| Наименование поля | Тип поля | Ключевое поле | Вид |
| --- | --- | --- | --- |
| Код должности | Числовой(11) | Первичный ключ | Обязательное |
| Наименование | Текстовый(30) |  | Обязательное |
| Оклад | Плавающая точка |  | Обязательное |

### Таблица 13
Клиент

| Наименование поля | Тип поля | Ключевое поле | Вид |
| --- | --- | --- | --- |
| Код клиента | Числовой(11) | Первичный ключ | Обязательное |
| Название фирмы/Представитель | Текстовый(100) |  | Обязательное |
| Адрес | Текстовый(100) |  | Обязательное |
| Телефон | Текстовый(11) |  | Обязательное |

### Таблица 14
Поставщик

| Наименование поля | Тип поля | Ключевое поле | Вид |
| --- | --- | --- | --- |
| Код поставщика | Числовой(11) | Первичный ключ | Обязательное |
| Название фирмы | Текстовый(100) |  | Обязательное |
| Адрес | Текстовый(100) |  | Обязательное |
| Телефон | Текстовый(11) |  | Обязательное |
| ИНН | Текстовый(12) |  | Обязательное |
Физическая модель БД
Конечная ER-модель реляционной БД

# 4 Реализация проекта БД средствами СУБД
См. 'aptela.sql'

# 5 SQL Запросы

1. Название лекарства, его стоимость и группа (запрос с INNER JOIN, ORDER BY).
SELECT `лекарство`.`Название` , `лекарство`.`Стоимость` , `назначение лекарства`.`Группа`
FROM `лекарство`
INNER JOIN `назначение лекарства` ON `назначение лекарства`.`Код назначения` = `лекарство`.`Код назначения`
ORDER BY `лекарство`.`Название`
![](images/sql_1.png?raw=true)

2. Лекарства, заказанные до определенного числа (запрос с GROUP BY, LEFT OUTER JOIN).
 `лекарство`.`Название` , `заказ`.`Дата размещения`
FROM `заказ`
 OUTER JOIN `товарная накладная заказа` ON `заказ`.`Код заказа`  `товарная накладная заказа`.`Код заказа`
 OUTER JOIN `продажа` ON `товарная накладная заказа`.`Код товарной накладной`  `продажа`.`Код товарной накладной`
 OUTER JOIN `лекарство` ON `продажа`.`Код лекарства`  `лекарство`.`Код лекарства`
GROUP BY `лекарство`.`Название`
HAVING `заказ`.`Дата размещения` 23 06 10
![](images/sql_2.png?raw=true)

3. Данные о поставках за все время (запрос с ORDER BY).
 `поставка`.`Код поставки` , `поставка`.`Дата поставки`
FROM `поставка`
ORDER BY `поставка`.`Дата поставки`
![](images/sql_3.png?raw=true)

4. Количество лекарств, стоимость которых ниже 500 у.е. (запрос с функцией COUNT (агрегирования))
 ( `Код лекарства` ) AS `Недорогие лекарства`
FROM `лекарство`
WHERE `Стоимость` 500
![](images/sql_4.png?raw=true)

5. Названия лекарства, его стоимость, страна производителя и название фирмы поставщика (запрос с INNER JOIN).
 `лекарство`.`Название` , `лекарство`.`Стоимость` , `лекарство`.`Страна производителя` , `поставщик`.`Название фирмы`
FROM `лекарство`
INNER JOIN `закупка` ON `закупка`.`Код лекарства`  `лекарство`.`Код лекарства`
INNER JOIN `товарная накладная поставки` ON `товарная накладная поставки`.`Код товарной накладной`  `закупка`.`Код товарной накладной`
INNER JOIN `поставка` ON `поставка`.`Код поставки`  `товарная накладная поставки`.`Код поставки`
INNER JOIN `поставщик` ON `поставщик`.`Код поставщика`  `поставка`.`Код поставщика`
![](images/sql_5.png?raw=true)

7. Названия лекарственных препаратов и группы их назначения.
 `лекарство`.`Название` , `назначение лекарства`.`Группа`
FROM `лекарство` , `назначение лекарства`
WHERE `лекарство`.`Код назначения`  `назначение лекарства`.`Код назначения`
 ![](images/sql_6.png?raw=true)

9. Товарные накладные заказов, номера которых совпадают с номерами заказов (запрос с рекурсивной функцией).
 `товарная накладная заказа`.`Код заказа` , `товарная накладная заказа`.`Код товарной накладной`
FROM `товарная накладная заказа`
WHERE `товарная накладная заказа`.`Код заказа`  `товарная накладная заказа`.`Код товарной накладной`
UNION
 T1.`Код заказа` , T1.`Код товарной накладной`
FROM `товарная накладная заказа` T1
WHERE T1.`Код заказа`  T1.`Код товарной накладной`

10. Количество товарных накладных по каждому клиенту (таблицы, связанные более чем по одному полю).
 `клиент`.`Название фирмы/Представитель` , ( `Код товарной накладной` ) AS `Количество накладных`
FROM `клиент` , `заказ` , `товарная накладная заказа`
WHERE `клиент`.`Код клиента`  `заказ`.`Код клиента`
 `заказ`.`Код заказа`  `товарная накладная заказа`.`Код заказа`
GROUP BY `клиент`.`Название фирмы/Представитель`

11. Сотрудники, их должности и оклады (запрос с использование CROSS JOIN).
 `сотрудник`.`Фамилия` , `сотрудник`.`Имя` , `сотрудник`.`Отчество` , `Должность`.`Наименование` , `Должность`.`Оклад`
FROM `сотрудник`
CROSS JOIN `должность` ON `сотрудник`.`Код должности`  `должность`.`Код должности`

12. Стоимость Супрастина повысилась на 20%.
UPDATE `лекарство` SET `лекарство`.`Стоимость` =`лекарство`.`Стоимость`*1.2
 WHERE `лекарство`.`Название` = ‘Супрастин’
